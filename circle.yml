dependencies:
  pre:
    - gem install cupertino
        timeout: 300
    - gem install shenzhen
        timeout: 300

dependencies:
  override:
    - gem install cupertino
        timeout: 300
    - gem install shenzhen
        timeout: 300

machine:
  xcode:
    version: '6.4'
  environment:
    XCODE_SCHEME: CircleCI-Test

test:
  override:
    - xcodebuild -project CircleCI-Test.xcodeproj -scheme CircleCI-Test -destination 'name=iPhone 6' clean test

deployment:
  deploygate:
    branch: master
    commands:
      - ios profiles:download AdHocTest --type distribution -u ${ITUNES_CONNECT_ID} -p ${ITUNES_CONNECT_PW}
      - ./scripts/add-key.sh
      - ipa build --clean -s AdHoc
      - ./scripts/remove-key.sh
      - ipa distribute:deploygate -m --api_token ${DEPLOYGATE_API_TOKEN} --user_name ${DEPLOYGATE_USERNAME}
